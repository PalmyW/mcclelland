<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>McClelland Trophy Live Ladder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f9f9f9;
            color: #333;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        th {
            background: #eee;
        }
    </style>
</head>

<body>
    <h1>McClelland Trophy Live Ladder</h1>
    <table id="ladder">
        <thead>
            <tr>
                <th>Position</th>
                <th>Club</th>
                <th>Played</th>
                <th>Points</th>
                <th>%</th>
                <th>Won</th>
                <th>Lost</th>
                <th>Drawn</th>
                <th>PF</th>
                <th>PA</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        async function loadData() {
            try {
                const [aflwRes, aflRes] = await Promise.all([
                    fetch('aflw.json'),
                    fetch('afl.json') // Changed from API to local file
                ]);

                const aflwData = await aflwRes.json();
                const aflData = await aflRes.json();

                // Mapping table to align AFLW team names with AFL / Squiggle names
                const aflNameMap = {
                    "Narrm": "Melbourne",
                    "Kangaroos": "North Melbourne",
                    "Kuwarna": "Adelaide",
                    "Waalitj Marawar": "West Coast",
                    "Yartapuulti": "Port Adelaide",
                    "Walyalup": "Fremantle",
                    "Euro-Yroke": "St Kilda",
                    "Sydney Swans": "Sydney",
                    "GWS GIANTS": "Greater Western Sydney",
                    "Geelong Cats": "Geelong",
                    "Gold Coast SUNS": "Gold Coast"
                };

                // Normalise AFLW data
                const aflwTeams = aflwData.teams.map(team => ({
                    club: aflNameMap[team.club] || team.club,
                    played: parseInt(team.played, 10),
                    points: parseInt(team.points, 10),
                    percentage: parseFloat(team.percentage),
                    won: parseInt(team.won, 10),
                    lost: parseInt(team.lost, 10),
                    drawn: parseInt(team.drawn, 10),
                    pf: parseInt(team.pf, 10),
                    pa: parseInt(team.pa, 10)
                }));

                // Use aflData.teams if your local JSON structure matches aflw.json,
                // or adjust as needed for your local file structure:
                const aflTeams = aflData.teams.map(team => ({
                    club: team.name,
                    played: team.played,
                    points: team.pts,
                    percentage: team.percentage,
                    won: team.wins,
                    lost: team.losses,
                    drawn: team.draws,
                    pf: team.for,
                    pa: team.against
                }));

                // Merge AFL and AFLW results by club name
                const combined = {};

                for (const t of aflwTeams) {
                    if (!combined[t.club]) combined[t.club] = { ...t };
                    else {
                        combined[t.club].played += t.played;
                        combined[t.club].points += t.points;
                        combined[t.club].pf += t.pf;
                        combined[t.club].pa += t.pa;
                        combined[t.club].won += t.won;
                        combined[t.club].lost += t.lost;
                        combined[t.club].drawn += t.drawn;
                    }
                }

                for (const t of aflTeams) {
                    if (!combined[t.club]) combined[t.club] = { ...t };
                    else {
                        combined[t.club].played += t.played;
                        combined[t.club].points += t.points;
                        combined[t.club].pf += t.pf;
                        combined[t.club].pa += t.pa;
                        combined[t.club].won += t.won;
                        combined[t.club].lost += t.lost;
                        combined[t.club].drawn += t.drawn;
                    }
                }

                // Recalculate percentages
                Object.values(combined).forEach(t => {
                    t.percentage = t.pa > 0 ? (t.pf / t.pa) * 100 : 0;
                });

                // Sort ladder by points, then percentage
                const ladder = Object.values(combined).sort((a, b) => {
                    if (b.points !== a.points) return b.points - a.points;
                    return b.percentage - a.percentage;
                });

                const tbody = document.querySelector('#ladder tbody');
                tbody.innerHTML = '';
                ladder.forEach((team, idx) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
            <td>${idx + 1}</td>
            <td>${team.club}</td>
            <td>${team.played}</td>
            <td>${team.points}</td>
            <td>${team.percentage.toFixed(1)}</td>
            <td>${team.won}</td>
            <td>${team.lost}</td>
            <td>${team.drawn}</td>
            <td>${team.pf}</td>
            <td>${team.pa}</td>
          `;
                    tbody.appendChild(row);
                });
            } catch (err) {
                console.error('Error loading ladder:', err);
                document.querySelector('#ladder tbody').innerHTML = `<tr><td colspan="10">Ladder unavailable</td></tr>`;
            }
        }

        loadData();
    </script>
</body>

</html>